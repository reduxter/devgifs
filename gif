import xlwings as xw
import os

def get_cell_values_xlwings(workbook_path, sheet_name, cell_range):
    """
    This function uses xlwings to get the values of a range of cells, resolving formulas through Excel.
    """
    # Check if the workbook exists
    if not os.path.exists(workbook_path):
        raise FileNotFoundError(f"Workbook '{workbook_path}' not found.")
    
    # Open the workbook with xlwings
    app = xw.App(visible=False)  # We don't need the Excel window to pop up
    try:
        wb = app.books.open(workbook_path)
        sheet = wb.sheets[sheet_name]
        
        # Get the values of the cells in the range (this will evaluate any formulas)
        values = sheet.range(cell_range).value
        
        # Return the resolved values
        return workbook_path, sheet_name, cell_range, values
    
    finally:
        wb.close()
        app.quit()


def find_final_values(workbook_path, sheet_name, cell_range):
    """
    This function finds the final values for a given range of cells, resolving any formulas.
    """
    try:
        workbook, sheet, cell_range, values = get_cell_values_xlwings(workbook_path, sheet_name, cell_range)
        print(f"Resolved values in: Workbook: {workbook}, Sheet: {sheet}, Range: {cell_range}, Values: {values}")
        return workbook, sheet, cell_range, values
    except Exception as e:
        return f"Error encountered: {str(e)}"


# Example usage:
workbook_path = r'\\network_drive\path\to\your\workbook.xlsx'
sheet_name = 'Sheet1'
cell_range = 'A1:B10'  # Define your range here

result = find_final_values(workbook_path, sheet_name, cell_range)
print(f"Final values found in: Workbook: {result[0]}, Sheet: {result[1]}, Range: {result[2]}, Values: {result[3]}")
